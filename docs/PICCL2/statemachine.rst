==========================
钱包应用状态机
==========================


.. Note :: 以下为钱包应用状态机

.. mermaid::

  graph TD
  
     kernel开始-->  空闲状态

     空闲状态-->  应用锁定
     空闲状态-->  圈存初始化
     空闲状态-->  圈提初始化
     空闲状态-->  修改初始化
     空闲状态-->  单次脱机消费初始化
     空闲状态-->  复合脱机消费初始化
	 
	 应用锁定-->  应用锁定状态
     圈存初始化-->  圈存状态
     圈提初始化-->  圈提状态
     修改初始化-->  修改透支限额状态
     单次脱机消费初始化-->  单次脱机消费状态
     复合脱机消费初始化-->  复合脱机消费状态1
	 
	 应用锁定状态-->  应用解锁
     圈存状态-->  圈存
     圈提状态-->  圈提
     修改透支限额状态-->  修改透支限额
     单次脱机消费状态-->  单次脱机消费
     复合脱机消费状态1-->  更新CAPP记录1A27xx
	 
	 更新CAPP记录1A27xx-->  更新CAPP记录1E01

     更新CAPP记录1E01-->  复合脱机消费状态2

     复合脱机消费状态2-->  复合脱机消费
	 
	 
	 圈存-->圈存闪卡
     圈提-->圈提闪卡
     修改透支限额-->修改透支限额闪卡
     单次脱机消费-->单次脱机消费闪卡
     复合脱机消费-->复合脱机消费闪卡


     圈存闪卡-->圈存闪卡处理
     圈提闪卡-->圈提闪卡处理
     修改透支限额闪卡-->修改透支限额闪卡处理
     单次脱机消费闪卡-->单次脱机消费闪卡处理
     复合脱机消费闪卡-->复合脱机消费闪卡处理
	 
	 应用解锁-->  恢复空闲
     圈存闪卡处理-->  恢复空闲
     圈提闪卡处理-->  恢复空闲
     修改透支限额闪卡处理-->  恢复空闲
     单次脱机消费闪卡处理-->  恢复空闲
     复合脱机消费闪卡处理-->  恢复空闲
	 
	 恢复空闲-->kernel结束
	 
	 
	 
.. warning:: 一票制的交易，可以使用单次脱机消费，也可以使用仅更新1E01（无需更新1A）的复合脱机消费；

.. warning:: 多票制的交易，需使用更新1E01结合更新2701（或2702，根据实际行业）的复合脱机消费；